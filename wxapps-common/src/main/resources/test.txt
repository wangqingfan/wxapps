SET FOREIGN_KEY_CHECKS=0;

DROP TABLE IF EXISTS `account`;
CREATE TABLE `account` (
  `account_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '客户资金账户ID',
  `account_type` tinyint(4) DEFAULT NULL COMMENT '账户类型 1,商户账户，2客户账户',
  `all_cash` decimal(18,2) DEFAULT NULL COMMENT '累计充值',
  `availablel_cash` decimal(18,2) DEFAULT NULL COMMENT '可用现金价值',
  `create_time` datetime DEFAULT NULL COMMENT '建立时间',
  `account_state` tinyint(4) DEFAULT NULL COMMENT '账户状态',
  `last_mdf_time` datetime DEFAULT NULL COMMENT '最后修改时间',
  PRIMARY KEY (`account_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='客户资金账户信息';

-- ----------------------------
-- Records of account
-- ----------------------------


-- ----------------------------
-- Table structure for admin_info
-- ----------------------------
DROP TABLE IF EXISTS `admin_info`;
CREATE TABLE `admin_info` (
  `admin_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '员工ID',
  `user_name` varchar(32) DEFAULT NULL COMMENT '员工名称',
  `admin_code` varchar(32) DEFAULT NULL COMMENT '工号',
  `password` varchar(32) DEFAULT NULL COMMENT '登录密码',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `admin_state` tinyint(4) DEFAULT NULL COMMENT '员工状态',
  `mobile_phone` varchar(16) DEFAULT NULL COMMENT '手机号',
  `email` varchar(64) DEFAULT NULL COMMENT '邮箱',
  `admin_id_code` varchar(18) DEFAULT NULL COMMENT '身份证号',
  `lst_mdf_time` datetime DEFAULT NULL COMMENT '最后修改时间',
  `mini_app_id` int(11) NOT NULL COMMENT '小程序id',
  PRIMARY KEY (`admin_id`)
) ENGINE=InnoDB AUTO_INCREMENT=27743 DEFAULT CHARSET=utf8 COMMENT='员工表';

-- ----------------------------
-- Records of admin_info
-- ----------------------------
INSERT INTO `admin_info` VALUES ('1', '系统管理员', 'admin', '96E79218965EB72C92A549DD5A330112', '2017-12-21 14:33:27', '1', '13888888888', 'admin@qq.com', '230230199405012329', '2017-12-21 14:33:51', '0');

-- ----------------------------
-- Table structure for bank_card
-- ----------------------------
DROP TABLE IF EXISTS `bank_card`;
CREATE TABLE `bank_card` (
  `bank_card_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '客户卡ID',
  `bank_id` int(11) DEFAULT NULL COMMENT '银行ID',
  `card_type` tinyint(4) DEFAULT NULL COMMENT '卡类型',
  `card_code` varchar(19) DEFAULT NULL COMMENT '卡号',
  `card_customer_name` varchar(32) DEFAULT NULL COMMENT '开户名',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `lst_mdf_time` datetime DEFAULT NULL COMMENT '最后修改时间',
  `mobile_phone` varchar(11) DEFAULT NULL COMMENT '银行卡预留手机号',
  `bind_card` tinyint(4) DEFAULT NULL COMMENT '是否绑卡 1 已绑卡 2 解绑',
  `bind_card_time` datetime DEFAULT NULL COMMENT '绑卡时间',
  PRIMARY KEY (`bank_card_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='客户卡信息';

-- ----------------------------
-- Records of bank_card
-- ----------------------------

-- ----------------------------
-- Table structure for bank_info
-- ----------------------------
DROP TABLE IF EXISTS `bank_info`;
CREATE TABLE `bank_info` (
  `bank_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '银行ID',
  `bank_name` varchar(64) DEFAULT NULL COMMENT '银行名称',
  `country_id` varchar(32) DEFAULT NULL COMMENT '所属国家',
  `province_id` varchar(32) DEFAULT NULL COMMENT '所属省',
  `p_city_id` varchar(32) DEFAULT NULL COMMENT '所属市',
  `city_id` varchar(64) DEFAULT NULL COMMENT '所属区县',
  PRIMARY KEY (`bank_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='银行信息';

-- ----------------------------
-- Records of bank_info
-- ----------------------------

-- ----------------------------
-- Table structure for customer_info
-- ----------------------------
DROP TABLE IF EXISTS `customer_info`;
CREATE TABLE `customer_info` (
  `customer_info_id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '客户主键id',
  `mini_app_id` int(11) NOT NULL COMMENT '小程序id',
  `customer_name` varchar(32) DEFAULT NULL COMMENT '客户姓名',
  `mobile_phone` varchar(12) DEFAULT NULL COMMENT '手机号',
  `email` varchar(32) DEFAULT NULL COMMENT '邮箱',
  `we_chat` varchar(32) DEFAULT NULL COMMENT '微信号',
  `sex` tinyint(4) DEFAULT NULL COMMENT '性别',
  `from_channel` tinyint(4) DEFAULT NULL COMMENT '客户来源，1门店扫码，2客户商店查询',
  `total_consume_money` decimal(18,2) DEFAULT NULL COMMENT '累计消费金额',
  `lives_province` varchar(32) DEFAULT NULL COMMENT '居住地所在省份',
  `lives_city` varchar(32) DEFAULT NULL COMMENT '居住地所在市',
  `lives_sub_city` varchar(32) DEFAULT NULL COMMENT '居住地所在区县',
  `lives_address` varchar(255) DEFAULT NULL COMMENT '居住地所在详细地址',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `lst_mod_time` datetime DEFAULT NULL COMMENT '修改时间',
  `customer_card_id` int(11) DEFAULT NULL COMMENT '客户绑定卡',
  PRIMARY KEY (`customer_info_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='客户信息';

-- ----------------------------
-- Records of customer_info
-- ----------------------------

-- ----------------------------
-- Table structure for mini_apps
-- ----------------------------
DROP TABLE IF EXISTS `mini_apps`;
CREATE TABLE `mini_apps` (
  `mini_app_id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '小程序id',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `app_id` varchar(32) NOT NULL COMMENT '客户端在微信端的appID',
  `app_secret` varchar(32) NOT NULL COMMENT '客户端在微信端的app密码',
  `app_state` tinyint(4) DEFAULT '1' COMMENT '是否在用该小程序,1在用，2不再续约',
  PRIMARY KEY (`mini_app_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='用户客户端';

-- ----------------------------
-- Records of mini_apps
-- ----------------------------

-- ----------------------------
-- Table structure for shop
-- ----------------------------
DROP TABLE IF EXISTS `shop`;
CREATE TABLE `shop` (
  `shop_id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键id',
  `mini_app_id` int(11) NOT NULL COMMENT '小程序id',
  `cutomer_name` varchar(32) DEFAULT NULL COMMENT '商户姓名',
  `id_code` varchar(32) DEFAULT NULL COMMENT '身份证号',
  `client_card_id` int(11) DEFAULT NULL COMMENT '客户端商家银行卡id',
  `shop_province` varchar(32) DEFAULT NULL COMMENT '商户所在省',
  `shop_city` varchar(32) DEFAULT NULL COMMENT '商户所在市',
  `shop_sub_city` varchar(64) DEFAULT NULL COMMENT '商户所有区县',
  `shop_address` varchar(255) DEFAULT NULL COMMENT '商户详细地址',
  `shop_telphone` varchar(32) DEFAULT NULL COMMENT '商户电话',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `lst_mod_time` datetime DEFAULT NULL COMMENT '修改时间',
  `shop_state` tinyint(4) DEFAULT '1' COMMENT '商户状态：1正在营业，2已停业',
  `total_deal_money` decimal(18,2) DEFAULT '0.00' COMMENT '累计成交金额',
  `account_id` int(11) DEFAULT NULL COMMENT '客户id',
  PRIMARY KEY (`shop_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='门店信息';

-- ----------------------------
-- Records of shop
-- ----------------------------


ALTER TABLE shop ADD `shop_type` TINYINT(4) DEFAULT NULL COMMENT '商户类型';


CREATE TABLE `restaurant`(
	`restaurant_id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '餐厅主键id',
	`least_consume` decimal(18,2) DEFAULT NULL COMMENT '最低消费金额',
	`delivery_distance` VARCHAR(8) DEFAULT NULL COMMENT '配送距离',
	`begin_bussinsess_time` datetime DEFAULT NULL COMMENT '开始营业时间',
	`end_bussinsess_time` datetime DEFAULT NULL COMMENT '结束营业时间',
	`bussiness_state` TINYINT(4) DEFAULT NULL COMMENT '营业状态',
	`announcement` VARCHAR(255) DEFAULT NULL COMMENT '公告内容',
	PRIMARY KEY (`restaurant_id`)
)


ALTER TABLE `restaurant` ADD `create_time` datetime DEFAULT NULL COMMENT '创建时间';
ALTER TABLE `restaurant` ADD `lst_mod_time` datetime DEFAULT NULL COMMENT '最后修改时间';

CREATE TABLE `activity`(
	`activity_id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键id',
	`content` VARCHAR(255) DEFAULT NULL COMMENT '内容',
	`state` TINYINT(4) DEFAULT NULL COMMENT '活动状态',
	`create_author_id` INT(11) DEFAULT NULL COMMENT '创建者id',
	`create_author_name` INT(11) DEFAULT NULL COMMENT '创建者姓名',
	`create_time` datetime DEFAULT NULL COMMENT '创建时间',
	`lst_mod_time` datetime DEFAULT NULL COMMENT '最后修改时间',
	PRIMARY KEY (`activity_id`)
)

ALTER TABLE restaurant ADD `shop_id` INT(11) NOT NULL COMMENT '商店id';
ALTER TABLE activity ADD `shop_id` INT(11) NOT NULL COMMENT '商店id';


ALTER TABLE restaurant drop begin_bussinsess_time ;
ALTER TABLE restaurant ADD begin_bussiness_time VARCHAR(4) DEFAULT NULL COMMENT '开始营业时间';
ALTER TABLE restaurant drop end_bussinsess_time ;
ALTER TABLE restaurant ADD end_bussiness_time VARCHAR(4) DEFAULT NULL COMMENT '结束营业时间';


CREATE TABLE `attachment` (
  `attachment_id` int(11) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `file_name` varchar(255) DEFAULT NULL COMMENT '文件名',
  `attachment_type` int(11) DEFAULT NULL COMMENT '附件类型',
  `file_type` varchar(32) DEFAULT NULL COMMENT '文件类型',
  `path_info` varchar(512) DEFAULT NULL COMMENT '存储位置',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `attachment_title` varchar(255) DEFAULT NULL COMMENT '附件标题',
  `state` varchar(16) DEFAULT NULL COMMENT '状态',
  `adminId` int(11) DEFAULT NULL COMMENT '创建人',
  `href` varchar(255) DEFAULT NULL COMMENT '外链地址',
  `width` int(11) DEFAULT NULL COMMENT '宽',
  `height` int(11) DEFAULT NULL COMMENT '高',
	`shop_id` int(11) NOT NULL COMMENT '商户id',
  PRIMARY KEY (`attachment_id`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8 COMMENT='附件表';

CREATE TABLE `evaluate`(
	`evaluate_id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '评价id',
	`restaurant_id` INT(11) NOT NULL COMMENT '餐厅id',
	`evaluate_level` TINYINT(4) DEFAULT NULL COMMENT '评分',
	`describe` VARCHAR(1000) DEFAULT NULL COMMENT '评价描述',
	`attachment_url` VARCHAR(255) DEFAULT NULL COMMENT '评分图片url',
	`customer_id` INT(11) DEFAULT NULL COMMENT '客户id',
	`customer_name` VARCHAR(20) DEFAULT NULL COMMENT '客户姓名',
	`is_anonymity` TINYINT(4) NOT NULL COMMENT '是否匿名',
	`create_time` datetime DEFAULT NULL COMMENT '创建时间',
	`evaluate_label` TINYINT(4) DEFAULT NULL COMMENT '标签',
	`is_best` TINYINT(4) DEFAULT NULL COMMENT '是否本次最佳',
	PRIMARY KEY (`evaluate_id`),
	KEY `idx_restaurant_id` (`restaurant_id`),
	KEY `idx_evaluate_level` (`evaluate_level`),
	KEY `idx_customer_id` (`customer_id`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8 COMMENT='评分'


ALTER TABLE restaurant ADD `total_evaluate_score` INT(32) DEFAULT NULL COMMENT '评价总分';
ALTER TABLE restaurant ADD `total_evaluate_person_num` INT(32) DEFAULT NULL COMMENT '评价总人数';
ALTER TABLE restaurant ADD `satisfaction` TINYINT(4) DEFAULT NULL COMMENT '店铺满意度';

ALTER TABLE evaluate CHANGE `describe` `description` VARCHAR(1000);


CREATE TABLE `product`(
	`product_id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '产品主键id',
	`product_name` VARCHAR(10) NOT NULL COMMENT '产品名称',
	`create_user_id` INT(11) NOT NULL COMMENT '创建人id',
	`create_time` datetime DEFAULT NULL COMMENT '创建时间',
	PRIMARY key (`product_id`)
)ENGINE=INNODB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8 COMMENT='菜品表';

CREATE TABLE `dishes`(
	`dishes_id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '菜品表主键id',
	`restaurant_id` INT(11) UNSIGNED NOT NULL COMMENT '饭店表id',
	`attachment_id` INT(11) UNSIGNED NOT NULL COMMENT '附件表id',
	`attachment_url` VARCHAR(255) DEFAULT NULL COMMENT '附件地址用于快捷查询的vo字段',
	`dishes_name` VARCHAR(20) DEFAULT NULL COMMENT '菜品名称',
	`create_time` datetime DEFAULT NULL COMMENT '创建时间',
	`lst_mod_time` datetime DEFAULT NULL COMMENT '最后修改时间',
	`dishes_state` TINYINT(4) DEFAULT NULL COMMENT '菜品状态',
	`description` VARCHAR(255) DEFAULT NULL COMMENT '菜品描述',
	`sell_price` decimal(18,2) DEFAULT NULL COMMENT '售价',
	`dishes_type` TINYINT(4) DEFAULT NULL COMMENT '菜品类型',
	PRIMARY KEY (`dishes_id`),
	KEY `idx_restaurant_id` (`restaurant_id`),
	KEY `idx_attachment_id` (`attachment_id`),
	KEY `idx_dishes_type` (`dishes_type`),
	KEY `idx_dishes_state` (`dishes_state`)
)ENGINE=INNODB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8 COMMENT='菜品表';

ALTER TABLE `shop` ADD `product_id` INT(11) DEFAULT NULL COMMENT '产品id';